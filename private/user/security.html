<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Security - Finanza Bank</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="/img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;500&display=swap" rel="stylesheet">  

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/static/lib/animate/animate.min.css" rel="stylesheet">
    <link href="/static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/static/css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar Start -->
    <div class="container-fluid fixed-top px-0 wow fadeIn" data-wow-delay="0.1s">
        <nav class="navbar navbar-expand-lg navbar-light py-lg-0 px-lg-5 wow fadeIn" data-wow-delay="0.1s">
            <a href="/user/dashboard" class="navbar-brand ms-4 ms-lg-0">
                <h5 class="m-0 text-primary"><i class="fa fa-university me-2"></i>Finanza</h5>
            </a>
            <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto p-4 p-lg-0">
                    <a href="/user/dashboard" class="nav-item nav-link">Dashboard</a>
                    <a href="/user/account" class="nav-item nav-link">Account</a>
                    <a href="/user/kyc_form" class="nav-item nav-link">KYC</a>
                    <div class="nav-item dropdown">
                        <a href="javascript:void(0)" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Products</a>
                        <div class="dropdown-menu border-light m-0">
                            <a href="/user/cards" class="dropdown-item">Cards</a>
                            <a href="/user/deposits" class="dropdown-item">Deposits</a>
                            <a href="/user/loans" class="dropdown-item">Loans</a>
                            <a href="/user/investments" class="dropdown-item">Investments</a>
                            <a href="/user/bill_pay" class="dropdown-item">Transfers</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="javascript:void(0)" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Services</a>
                        <div class="dropdown-menu border-light m-0">
                            <a href="/user/analytics" class="dropdown-item">Business Analysis</a>
                            <a href="/user/treasury_portfolio" class="dropdown-item">Financial Planning</a>
                            <a href="/user/insurance" class="dropdown-item">Insurance</a>
                            <a href="/user/treasury_portfolio" class="dropdown-item">Projects</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="javascript:void(0)" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">More</a>
                        <div class="dropdown-menu border-light m-0">
                            <a href="/user/profile" class="dropdown-item">Profile</a>
                            <a href="/user/settings" class="dropdown-item">Settings</a>
                            <a href="/user/notifications" class="dropdown-item">Notifications</a>
                            <a href="/user/transactions" class="dropdown-item">Transactions</a>
                            <a href="/user/security" class="dropdown-item">Security</a>
                            <a href="/user/alerts" class="dropdown-item">Alerts</a>
                            <a href="/user/contact" class="dropdown-item">Contact/Support</a>
                            <hr class="m-2">
                            <a href="/logout" class="dropdown-item text-danger">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
    <!-- Navbar End -->

    <!-- Page Header Start -->
    <div class="container-fluid page-header mb-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container">
            <h1 class="display-4 pb-3 animated slideInDown">Security</h1>
            <nav aria-label="breadcrumb animated slideInDown">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a class="text-white" href="/user/dashboard">Home</a></li>
                    <li class="breadcrumb-item text-primary active" aria-current="page">Security</li>
                </ol>
            </nav>
        </div>
    </div>
    <!-- Page Header End -->

    <!-- Content Start -->
    <div class="container-xxl py-5">
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-12 wow fadeInUp" data-wow-delay="0.1s">

    <div class="container-fluid pt-4 pb-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="mb-0">
                <i class="fas fa-lock me-2"></i>Security Settings
            </h2>
        </div>
    </div>

    <!-- Security Status Overview -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-shield-alt text-success" style="font-size: 2rem;"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="card-title">Security Score</h6>
                            <p class="mb-0"><span id="securityScore">85</span>%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-mobile-alt text-info" style="font-size: 2rem;"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="card-title">2FA Status</h6>
                            <p class="mb-0" id="twoFAStatus">
                                <span class="badge bg-success">Enabled</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-laptop text-warning" style="font-size: 2rem;"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="card-title">Active Devices</h6>
                            <p class="mb-0" id="activeDeviceCount">2</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-key text-danger" style="font-size: 2rem;"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="card-title">Password</h6>
                            <p class="mb-0">
                                <small id="passwordAge" class="text-muted">45 days old</small>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs for Different Security Options -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" href="#password" data-bs-toggle="tab">
                <i class="fas fa-key me-1"></i>Password
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#twoFA" data-bs-toggle="tab">
                <i class="fas fa-mobile-alt me-1"></i>Two-Factor Authentication
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#devices" data-bs-toggle="tab">
                <i class="fas fa-laptop me-1"></i>Devices
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#activity" data-bs-toggle="tab">
                <i class="fas fa-history me-1"></i>Login History
            </a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- Password Tab -->
        <div class="tab-pane fade show active" id="password" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Change Password</h5>
                </div>
                <div class="card-body">
                    <form id="passwordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                        </div>

                        <hr>

                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                            <small class="form-text text-muted d-block mt-2">
                                <i class="fas fa-info-circle"></i>
                                Password must contain:
                            </small>
                            <ul class="small text-muted mt-1" style="margin-left: 1.2rem;">
                                <li id="lengthCheck"><i class="fas fa-times text-danger"></i> At least 8 characters</li>
                                <li id="uppercaseCheck"><i class="fas fa-times text-danger"></i> At least one uppercase letter</li>
                                <li id="lowercaseCheck"><i class="fas fa-times text-danger"></i> At least one lowercase letter</li>
                                <li id="numberCheck"><i class="fas fa-times text-danger"></i> At least one number</li>
                                <li id="specialCheck"><i class="fas fa-times text-danger"></i> At least one special character (!@#$%)</li>
                            </ul>
                        </div>

                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                            <small class="form-text text-danger d-none" id="passwordMismatch">Passwords do not match</small>
                        </div>

                        <div class="alert alert-info" role="alert">
                            <i class="fas fa-info-circle me-1"></i>
                            <strong>Password Policy:</strong> Your new password must be different from your current password and cannot be reused within the last 5 passwords.
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="reset" class="btn btn-outline-secondary">Cancel</button>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Two-Factor Authentication Tab -->
        <div class="tab-pane fade" id="twoFA" role="tabpanel">
            <div class="card mb-4">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Two-Factor Authentication</h5>
                        <span class="badge bg-success" id="twoFABadge">Enabled</span>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">Two-factor authentication adds an extra layer of security to your account. In addition to your password, you'll need to provide a verification code to sign in.</p>

                    <h6>Authentication Methods:</h6>
                    <div id="authMethods">
                        <div class="mb-3">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-mobile-alt text-success me-2"></i>
                                        Authenticator App
                                    </h6>
                                    <small class="text-muted">Google Authenticator, Microsoft Authenticator, Authy</small>
                                </div>
                                <div class="ms-auto">
                                    <span class="badge bg-success">Active</span>
                                    <button class="btn btn-sm btn-outline-danger ms-2" data-bs-toggle="modal" data-bs-target="#removeMethodModal" onclick="setRemoveMethod('authenticator')">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-phone text-secondary me-2"></i>
                                        SMS Text Message
                                    </h6>
                                    <small class="text-muted">+1 (XXX) XXX-5678</small>
                                </div>
                                <div class="ms-auto">
                                    <span class="badge bg-secondary">Inactive</span>
                                    <button class="btn btn-sm btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#setupSMSModal">
                                        Setup
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-envelope text-secondary me-2"></i>
                                        Email
                                    </h6>
                                    <small class="text-muted">user***@example.com</small>
                                </div>
                                <div class="ms-auto">
                                    <span class="badge bg-secondary">Inactive</span>
                                    <button class="btn btn-sm btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#setupEmailModal">
                                        Setup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h6 class="mb-3">Backup Codes</h6>
                    <p class="small text-muted mb-3">Save these codes in a safe place. You can use them to access your account if you lose access to your 2FA device.</p>
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#backupCodesModal">
                        <i class="fas fa-download me-1"></i>View/Regenerate Codes
                    </button>
                </div>
            </div>
        </div>

        <!-- Devices Tab -->
        <div class="tab-pane fade" id="devices" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Active Devices</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">These are the devices currently linked to your account. Review the list and remove any unrecognized devices.</p>
                    <div id="devicesList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Login History Tab -->
        <div class="tab-pane fade" id="activity" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Login History</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Date & Time</th>
                                <th>Device</th>
                                <th>Location</th>
                                <th>IP Address</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="loginHistoryList">
                            <tr><td colspan="6" class="text-center py-4">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->

<!-- Backup Codes Modal -->
<div class="modal fade" id="backupCodesModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Backup Codes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    Keep these codes safe. Regenerating new codes will invalidate all previous codes.
                </div>
                <div class="bg-light p-3 rounded mb-3">
                    <code id="backupCodesDisplay" style="word-break: break-all; white-space: pre-wrap;">
                        <!-- Codes will be displayed here -->
                    </code>
                </div>
                <button class="btn btn-outline-primary w-100" onclick="copyBackupCodes()">
                    <i class="fas fa-copy me-1"></i>Copy Codes
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="regenerateBackupCodes()">
                    <i class="fas fa-redo me-1"></i>Regenerate
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>

<!-- Setup SMS Modal -->
<div class="modal fade" id="setupSMSModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Setup SMS 2FA</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="smsForm">
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phoneNumber" required>
                    </div>
                    <button type="button" class="btn btn-primary w-100" id="sendSMSCode">
                        Send Code
                    </button>
                    <div id="verifyCodeGroup" style="display: none;">
                        <hr>
                        <label for="smsCode" class="form-label mt-3">Enter Code</label>
                        <input type="text" class="form-control" id="smsCode">
                        <button type="submit" class="btn btn-primary w-100 mt-3">Verify & Enable</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Remove Method Modal -->
<div class="modal fade" id="removeMethodModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Remove Authentication Method</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-danger mb-3">
                    <i class="fas fa-warning me-2"></i>
                    <strong>Warning:</strong> Are you sure you want to remove this authentication method? You should have another method enabled.
                </p>
                <p id="methodToRemove"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmRemoveMethod()">Remove</button>
            </div>
        </div>
    </div>
</div>

<style>
    .device-item {
        border-left: 4px solid #007bff;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8f9fa;
        border-radius: 4px;
    }
    .device-item.current {
        border-left-color: #28a745;
        background-color: #d4edda;
    }
    .device-item.suspicious {
        border-left-color: #dc3545;
    }
</style>

<script>
let currentRemoveMethod = null;

document.addEventListener('DOMContentLoaded', async function() {
    await loadLoginHistory();
    await loadDevices();
    setupPasswordValidation();
    setupPasswordForm();
});

function setupPasswordValidation() {
    const newPassword = document.getElementById('newPassword');
    
    newPassword.addEventListener('input', function() {
        const password = this.value;
        
        checkRequirement('lengthCheck', password.length >= 8);
        checkRequirement('uppercaseCheck', /[A-Z]/.test(password));
        checkRequirement('lowercaseCheck', /[a-z]/.test(password));
        checkRequirement('numberCheck', /[0-9]/.test(password));
        checkRequirement('specialCheck', /[!@#$%^&*]/.test(password));
    });

    document.getElementById('confirmPassword').addEventListener('input', function() {
        const mismatch = document.getElementById('passwordMismatch');
        if (this.value && newPassword.value !== this.value) {
            mismatch.classList.remove('d-none');
        } else {
            mismatch.classList.add('d-none');
        }
    });
}

function checkRequirement(elementId, isMet) {
    const element = document.getElementById(elementId);
    if (isMet) {
        element.innerHTML = element.innerHTML.replace('fa-times text-danger', 'fa-check text-success');
    } else {
        element.innerHTML = element.innerHTML.replace('fa-check text-success', 'fa-times text-danger');
    }
}

async function setupPasswordForm() {
    document.getElementById('passwordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (newPassword !== confirmPassword) {
            alert('Passwords do not match');
            return;
        }

        try {
            const response = await fetch('/api/security/change-password', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    current_password: currentPassword,
                    new_password: newPassword
                })
            });

            if (response.ok) {
                alert('Password changed successfully');
                this.reset();
            } else {
                alert('Failed to change password');
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    });
}

async function loadLoginHistory() {
    try {
        const response = await fetch('/api/security/login-history', {
            headers: {'Authorization': `Bearer ${localStorage.getItem('token')}`}
        });
        const history = await response.json();

        const tbody = document.getElementById('loginHistoryList');
        tbody.innerHTML = history.map(log => `
            <tr>
                <td>${new Date(log.timestamp).toLocaleString()}</td>
                <td>${log.device_name || 'Unknown'}</td>
                <td>${log.location || 'Unknown'}</td>
                <td><code>${log.ip_address}</code></td>
                <td><span class="badge bg-${log.success ? 'success' : 'danger'}">${log.success ? 'Success' : 'Failed'}</span></td>
                <td>
                    ${!log.current ? `<button class="btn btn-sm btn-outline-danger" onclick="reportSuspicious('${log.id}')">Report</button>` : '<span class="text-muted">Current</span>'}
                </td>
            </tr>
        `).join('');
    } catch (error) {
        console.error('Error loading login history:', error);
    }
}

async function loadDevices() {
    try {
        const response = await fetch('/api/security/devices', {
            headers: {'Authorization': `Bearer ${localStorage.getItem('token')}`}
        });
        const devices = await response.json();

        const list = document.getElementById('devicesList');
        list.innerHTML = devices.map(device => `
            <div class="device-item ${device.current_device ? 'current' : ''}">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">
                            <i class="fas fa-${device.device_type === 'mobile' ? 'mobile-alt' : 'laptop'} me-2"></i>
                            ${device.device_name}
                            ${device.current_device ? '<span class="badge bg-success ms-2">Current Device</span>' : ''}
                        </h6>
                        <p class="small text-muted mb-1">
                            <i class="fas fa-map-marker-alt me-1"></i>${device.location}
                        </p>
                        <p class="small text-muted mb-1">
                            <i class="fas fa-globe me-1"></i>${device.ip_address}
                        </p>
                        <p class="small text-muted mb-0">
                            <i class="fas fa-clock me-1"></i>Last used: ${new Date(device.last_activity).toLocaleString()}
                        </p>
                    </div>
                    <div>
                        ${!device.current_device ? `<button class="btn btn-sm btn-outline-danger" onclick="removeDevice('${device.id}')">Remove</button>` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading devices:', error);
    }
}

function setRemoveMethod(method) {
    currentRemoveMethod = method;
    document.getElementById('methodToRemove').textContent = method.charAt(0).toUpperCase() + method.slice(1);
}

function confirmRemoveMethod() {
    if (currentRemoveMethod) {
        // API call to remove method
        console.log('Removing method:', currentRemoveMethod);
        bootstrap.Modal.getInstance(document.getElementById('removeMethodModal')).hide();
    }
}

async function removeDevice(deviceId) {
    if (confirm('Remove this device?')) {
        try {
            const response = await fetch(`/api/security/devices/${deviceId}`, {
                method: 'DELETE',
                headers: {'Authorization': `Bearer ${localStorage.getItem('token')}`}
            });
            if (response.ok) {
                await loadDevices();
            }
        } catch (error) {
            alert('Error removing device: ' + error.message);
        }
    }
}

function copyBackupCodes() {
    const codes = document.getElementById('backupCodesDisplay').textContent;
    navigator.clipboard.writeText(codes).then(() => {
        alert('Codes copied to clipboard');
    });
}

async function regenerateBackupCodes() {
    if (confirm('Regenerate backup codes? Your old codes will no longer work.')) {
        // API call to regenerate codes
        console.log('Regenerating backup codes');
    }
}

async function reportSuspicious(logId) {
    if (confirm('Report this login as suspicious?')) {
        try {
            const response = await fetch(`/api/security/report-suspicious/${logId}`, {
                method: 'POST',
                headers: {'Authorization': `Bearer ${localStorage.getItem('token')}`}
            });
            if (response.ok) {
                alert('Thank you. We\'ve secured your account.');
                await loadLoginHistory();
            }
        } catch (error) {
            alert('Error reporting suspicious activity: ' + error.message);
            }
        }
    }
</script>

                </div>
            </div>
        </div>
    </div>
    <!-- Content End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer mt-5 py-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white mb-4">Address</h5>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>123 Street, New York, USA</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/lib/wow/wow.min.js"></script>
    <script src="/static/lib/easing/easing.min.js"></script>
    <script src="/static/lib/waypoints/waypoints.min.js"></script>
    <script src="/static/lib/counterup/counterup.min.js"></script>
    <script src="/static/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script src="/static/js/user-guard.js"></script>
</body>

</html>